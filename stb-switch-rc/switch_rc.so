#!/bin/sh
###############################################
### Switch RC Code by BPanther, 15-Dec-2019 ###
###############################################

BOXMODEL=`cat /proc/stb/info/model`
case $BOXMODEL in
	hd51)
		DEFAULT_RC=8;;
	h7)
		DEFAULT_RC=9;;
	bre2ze4k)
		DEFAULT_RC=10;;
	*)
		DEFAULT_RC=8;;
esac

setrccode () {
	case $1 in
	1)  echo 4 > /proc/stb/ir/rc/type
	    echo 4 > /var/etc/rccode;;
	2)  echo 5 > /proc/stb/ir/rc/type
	    echo 5 > /var/etc/rccode;;
	3)  echo 7 > /proc/stb/ir/rc/type
	    echo 7 > /var/etc/rccode;;
	4)  echo 8 > /proc/stb/ir/rc/type
	    echo 8 > /var/etc/rccode;;
	5)  echo 9 > /proc/stb/ir/rc/type
	    echo 9 > /var/etc/rccode;;
	6)  echo 11 > /proc/stb/ir/rc/type
	    echo 11 > /var/etc/rccode;;
	7)  echo 13 > /proc/stb/ir/rc/type
	    echo 13 > /var/etc/rccode;;
	8)  echo 16 > /proc/stb/ir/rc/type
	    echo 16 > /var/etc/rccode;;
	9)  echo 21 > /proc/stb/ir/rc/type
	    echo 21 > /var/etc/rccode;;
	10) echo 23 > /proc/stb/ir/rc/type
	    echo 23 > /var/etc/rccode;;
	*)  exit;;
	esac
}

# with parameter "start" -> set only rc code
if [ "$1" == "start" ]; then
	[ -e /var/etc/rccode ] && echo -n `cat /var/etc/rccode` > /proc/stb/ir/rc/type
	exit
fi

# plugin menu
msgbox title="Fernbedienung umschalten" msg="~cDiese Fernbedienungen stehen zur Wahl" select="Dreambox,et9000,et5000/et6000,VU+ (Code 0001),et6500/et8000/et9500/et10000,et9200,et4000,et7000/et7500/et8500/HD51,ZGEMMA H7,BRE2ZE 4K" default=$DEFAULT_RC
setrccode $?

msgbox title="Fernbedienungscode umschalten" msg="~cFunktioniert die Fernbedienung?" select="Ja,Nein" default=2 timeout=15
if [ "$?" == "1" ]; then
	exit
else
	setrccode $DEFAULT_RC
	msgbox title="Fernbedienungscode umschalten" popup="~cOriginaler Fernbedienungscode wiederhergestellt." timeout=3
fi
